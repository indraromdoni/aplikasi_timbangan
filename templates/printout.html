<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Print Hasil Timbang</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <style>
    @page { size: A5; margin: 10mm; }
    body { font-family: Arial, sans-serif; font-size: 11px; }
    .header { text-align:center; font-weight:700; margin-bottom:8px; }
    .small { font-size:11px; color:#333; }
    .signature-area {
      position: fixed;
      bottom: 5mm;
      left: 0;
      right: 0;
      width: 100%;
    }

    .signature-box {
      width: 35%;
      float: left;
      text-align: center;
      font-size: 11px;
    }

    .signature-box.right {
      float: right;
    }

    .line {
      width: 70%;
      margin: 50px auto 0 auto;
      border-top: 1px solid black;
      height: 1px;
    }
  </style>
</head>
<body onafterprint="myFunction()">
  <div class="header">Hasil Timbang</div>
  <table>
    <tr>
      <td><strong>Tanggal</strong></td>
      <td><strong>:</strong></td>
      <td><div id="tanggal"></div></td>
      <td>&nbsp;&nbsp;&nbsp;</td>
      <td><strong>Nopol</strong></td>
      <td><strong>:</strong></td>
      <td><div id="nopol"></div></td>
    </tr>
    <tr>
      <td><strong>Supplier</strong></td>
      <td><strong>:</strong></td>
      <td><div id="supplier"></div></td>
      <td></td>
      <td><strong>Driver</strong></td>
      <td><strong>:</strong></td>
      <td><div id="driver"></div></td>
    </tr>
  </table>
  <br>
  Rincian:
  <br>
  <div id="dataTabel"></div>
  <hr>
  <!--div class="small">Dicetak dari sistem Timbangan</div-->
  <div class="signature-area">
    <div class="signature-box">
        Penimbang
        <div class="line"></div>
    </div>

    <div class="signature-box right">
        Pengawal
        <div class="line"></div>
    </div>
  </div>
  <script>
    window.print();
  </script>
</body>
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  function myFunction() {
    window.close();
  }

  const data = {{ data_print | tojson }};
  console.log(data);

  document.getElementById('tanggal').textContent = new Date().toLocaleDateString('id-ID');
  document.getElementById('supplier').textContent = data.supplier;
  document.getElementById('nopol').textContent = data.nopol;
  document.getElementById('driver').textContent = data.driver;

  const container = document.getElementById('dataTabel');
  container.innerHTML = "";  

  let html = "";
  let colCount = 0;

  data.produk.forEach((itemProduk, index) => {
      const namaProduk = Object.keys(itemProduk)[0];
      const daftar = itemProduk[namaProduk];
      console.log(namaProduk);
      console.log(daftar);

      // BUKA row baru setiap 6 kolom
      if (colCount === 0) {
          html += `<div class="row g-3 mb-2">`;
      }

      html += `
          <div class="col-3"> 
              <div class="fw-bold text-center mb-1">${namaProduk}</div>
              <table class="table table-bordered table-sm" style="font-size:11px;">
                  <thead class="table-light text-center">
                      <tr>
                          <th>Kotor</th>
                          <th>Tare</th>
                          <th>Nett</th>
                      </tr>
                  </thead>
                  <tbody>
      `;

      daftar.forEach(baris => {
          html += `
              <tr class="text-end">
                  <td>${baris.berat_kotor}</td>
                  <td>${baris.berat_tare}</td>
                  <td>${baris.berat_nett}</td>
              </tr>
          `;
      });

      html += `
                  </tbody>
              </table>
          </div>
      `;

      colCount++;

      // Jika sudah 6 kolom, tutup row
      if (colCount === 4) {
          html += `</div>`;
          colCount = 0;
      }
  });

  // Jika loop berhenti tapi row belum ditutup
  if (colCount !== 0) {
      html += `</div>`;
  }

  container.innerHTML = html;
</script>
</html>